## 概要

Markdown形式のテーブルをフォーマットするNeovimプラグインです。

- `TableFormat` コマンドでカーソルが所属するテーブルをフォーマットします
- UTF-8文字に対応しています

## プロジェクトの進め方

### Issueドリブン

`./issues/` 配下にissueが作成されているのでそれに従います。

- 1ファイル 1 issueです
- タイトル・概要・ステータス・進捗状況・作業記録は、issueファイルに追記・更新します

#### Issueのプロパティ一覧


| プロパティ | 定義                                                             |
| -          | -                                                                |
| タイトル   | issueのタイトル                                                  |
| 概要       | issueの概要を説明した文章                                        |
| ステータス | オープン,進行中,クローズ のいずれか                              |
| 作業記録   | 作業したことや必要な情報を都度加筆していく. コメントみたいなもの |


`作業記録` は日付付きで以下のように追記していってください。

```
### 👤 <記録者名> YYYY/MM/DD hh:mm:ss

ここに色々と必要なことを書く
```

- `YYYY/MM/DD` は本日の日付(タイムゾーンはJST)
- `hh:mm:ss` は記載時刻(タイムゾーンはJST)

たとえば以下のように。

```
### 👤 Claude Code 2025/06/28 17:18:26

開発を開始しました。
```

作業記録にはGitHub issuesのように人間もコメントします。そのための記録者名です。

```
### 👤 tadashi-aikawa 2025/06/28 17:28:26

確認しました。バグが残っているのでログを貼ります。(以下略)
```

### Issue一覧

各issueのファイル名(.md除く)、タイトル、ステータス、最終更新日のリストです。**issueのファイルでこれらに変更があった場合は、以下も必ず更新してください**。


| ファイル名 | タイトル                                                                      | ステータス | 最終更新日          |
| ---------- | ----------------------------------------------------------------------------- | ---------- | ------------------- |
| ISSUE-1    | `TableFormat`コマンドでカーソル配下のテーブルをフォーマットできるようにする。 | クローズ   | 2025/06/28 17:55:00 |
| ISSUE-2    | テストフレームワークの導入とユニットテスト実装                                | クローズ   | 2025/06/28 18:32:00 |
| ISSUE-3    | GitHubリポジトリの作成                                                        | クローズ   | 2025/06/28 18:51:00 |
| ISSUE-4    | StyLuaのフォーマット対応                                                      | クローズ   | 2025/06/28 19:32:40 |
| ISSUE-6    | ヘッダのみ最小限の記載でテーブルフォーマット                                  | クローズ   | 2025/06/29 17:42:18 |
| ISSUE-7    | レコードの先頭がパイプのみだとエラーになる                                    | クローズ   | 2025/06/29 18:00:21 |
| ISSUE-8    | レコードの先頭または末尾の列が`-`のみで構成される値だとフォーマット結果が不正 | クローズ   | 2025/07/02 16:17:16 |


## コミットルール

- Conventional Commitでお願いします
- 1行目だけで要点が伝わるようなメッセージにしてください
  - 変更量が非常に多く1行で表現できないケースを除き、2行目以降を使うのは禁止です

## CI/CD

### フォーマット

- StyLuaによるフォーマットチェックがCIで実行されます
- ローカルで `stylua .` を実行してフォーマットを適用してください
- フォーマットエラーがある場合は `stylua --check .` でチェックできます

### 作業記録

### 👤 Claude Code 2025/06/30 02:25:02

CIでStyLuaフォーマットエラーが発生していました。以下の修正を行いました：

- 空行の統一（末尾空白の削除）  
- テーブル引数のスペース統一 `{target_line, 2}` → `{ target_line, 2 }`
- コメントのスペース統一 `{},  -- empty row` → `{}, -- empty row`

修正後は `stylua .` でフォーマットを適用し、`stylua --check .` で確認することで、同様のエラーを防げます。

### 👤 Claude Code 2025/07/02 16:17:16

ISSUE-8修正により得られた知見：

**パターンマッチングの限界とセルレベル解析の重要性**
- 正規表現によるパターンマッチングは効率的だが、複雑なケースで誤判定のリスクがある
- テーブル構造を扱う場合、行全体のパターンではなくセルレベルでの詳細解析が確実
- `is_separator_line`のような判定ロジックでは、各セルの内容を個別に検査することで精度向上

**テスト駆動開発の効果**
- 修正前に失敗するテストケースを追加することで、問題の再現と修正効果の確認が確実に行える
- 単体テスト（parser_spec.lua）とE2Eテスト（e2e_spec.lua）両方でカバーすることで網羅的検証が可能

**既存機能への影響最小化**
- 既存の60個のテストが全て通過することで、修正が他機能に悪影響を与えていないことを確認
- リファクタリング時は既存テストを維持しつつ新機能のテストを追加するアプローチが有効

